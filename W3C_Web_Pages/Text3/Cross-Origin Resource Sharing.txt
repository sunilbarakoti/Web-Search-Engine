Cross-Origin Resource Sharing Cross-Origin Resource Sharing W3C Recommendation January Version: http://www.w3.org/TR/2014/REC-cors-20140116/ Latest Version: http://www.w3.org/TR/cors/ Previous Versions: http://www.w3.org/TR/2013/PR-cors-20131205/ http://www.w3.org/TR/2013/CR-cors-20130129/ http://www.w3.org/TR/2012/WD-cors-20120403/ http://www.w3.org/TR/2010/WD-cors-20100727/ http://www.w3.org/TR/2009/WD-cors-20090317/ http://www.w3.org/TR/2008/WD-access-control-20080912/ http://www.w3.org/TR/2008/WD-access-control-20080214/ http://www.w3.org/TR/2007/WD-access-control-20071126/ http://www.w3.org/TR/2007/WD-access-control-20071001/ http://www.w3.org/TR/2007/WD-access-control-20070618/ http://www.w3.org/TR/2007/WD-access-control-20070215/ http://www.w3.org/TR/2006/WD-access-control-20060517/ http://www.w3.org/TR/2005/NOTE-access-control-20050613/ Editor: Anne van Kesteren Opera Software ASA) <annevk@annevk.nl> note there be errata document. English version specification only normative version. Non-normative translations also be available. Copyright Â© W3CÂ® ERCIM, Keio, Beihang), Rights Reserved. W3C liability, trademark document use rules apply. Abstract document mechanism enable client-side cross-origin requests. Specifications enable API make cross-origin requests resources use algorithms defined specification. such API used http://example.org resources, resource http://hello-world.example opt using mechanism described specification specifying Access-Control-Allow-Origin: http://example.org response header), allow resource be fetched cross-origin http://example.org. Status Document section status document time publication. Other documents supersede document. list current W3C publications latest revision technical report be found W3C technical reports index http://www.w3.org/TR/. document been reviewed W3C Members, software developers, other W3C groups interested parties, endorsed Director W3C Recommendation. stable document be used reference material cited document. W3C's role making Recommendation draw attention specification promote widespread deployment. functionality interoperability Web. W3C Recommendation CORS was produced jointly Web Applications Web Application Security Working Groups, published WebAppSec Working Group. changes were made previous publication Proposed Recommendation. wish make comments regarding document, please send public-webappsec@w3.org archives). document was produced groups operating February W3C Patent Policy. W3C public list patent disclosures WebAppSec WG WebApps WG made connection deliverables group; page also instructions disclosing patent. individual actual knowledge patent individual Essential Claim(s) disclose information accordance section W3C Patent Policy. publishing Recommendation W3C functionality specified Cross-Origin Resource Sharing Recommendation not be affected changes HTML5 HTTP Status Code specifications proceed Recommendation RFC status respectively. initial implementation report available, supplement changes Candidate Recommendation. Table Contents Introduction Conformance Terminology Security Considerations Syntax Access-Control-Allow-Origin Response Header Access-Control-Allow-Credentials Response Header Access-Control-Expose-Headers Response Header Access-Control-Max-Age Response Header Access-Control-Allow-Methods Response Header Access-Control-Allow-Headers Response Header Origin Request Header Access-Control-Request-Method Request Header Access-Control-Request-Headers Request Header Resource Processing Model Simple Cross-Origin Request, Actual Request, Redirects Preflight Request Security Implementation Considerations User Agent Processing Model Cross-Origin Request Handling Response Cross-Origin Request Cross-Origin Request Status Source Origin Simple Cross-Origin Request Cross-Origin Request Preflight Preflight Result Cache Generic Cross-Origin Request Algorithms Resource Sharing Check Security CORS API Specification Advice Constructing Cross-Origin Request Dealing Same Origin Cross-Origin Redirects Dealing Cross-Origin Request Status Security References Acknowledgments Introduction section non-normative. User agents commonly apply same-origin restrictions network requests. restrictions prevent client-side Web application running origin obtaining data retrieved origin, also limit unsafe HTTP requests be automatically launched destinations differ running application's origin. user agents follow pattern, network requests typically include user credentials cross-origin requests, including HTTP authentication cookie information. specification model several ways: response include Access-Control-Allow-Origin header, origin request originated value, allow access resource's contents. user agent value origin request originated match. User agents discover preflight request cross-origin resource prepared accept requests, using non-simple method, given origin. again validated user agent. Server-side applications are enabled discover HTTP request was deemed cross-origin request user agent, Origin header. extension server-side applications enforce limitations returning nothing) cross-origin requests are willing service. specification building block other specifications, so-called CORS API specifications, define specification used. Examples are Server-Sent Events XMLHttpRequest. CORS wiki page more background information document. resource author simple text resource residing http://example.com/hello string World!" http://hello-world.example be able access response combined header introduced specification look Access-Control-Allow-Origin: http://hello-world.exampleHello World! Using XMLHttpRequest client-side Web application http://hello-world.example access resource var client = new XMLHttpRequest()client.open("GET", = function() do something slightly more resource author be able handle cross-origin requests using methods other simple methods. case author needs reply preflight request uses OPTIONS method then needs handle actual request uses desired method example) give appropriate response. response preflight request have following headers specified: Access-Control-Allow-Origin: http://hello-world.exampleAccess-Control-Max-Age: 3628800Access-Control-Allow-Methods: PUT, DELETE Access-Control-Max-Age header long response be cached, so subsequent requests, specified time, preflight request be made. Access-Control-Allow-Methods header methods be used actual request. response actual request simply contain header: Access-Control-Allow-Origin: http://hello-world.example complexity invoking additional preflight request task user agent. Using XMLHttpRequest again assuming application were hosted http://calendar.example/app author use following ECMAScript snippet: function deleteItem(itemId, updateUI) var client = new XMLHttpRequest() client.open("DELETE", client.onload = updateUI client.onerror = updateUI client.onabort = updateUI client.send("id=" itemId)} Conformance specification written resource authors user agents. advice specifications define APIs use cross-origin request algorithm defined specification CORS API specifications general security considerations section advice client-side Web application authors. well sections appendices marked non-normative, diagrams, examples, notes specification are non-normative. Everything else specification normative. specification, words are be interpreted described RFC Requirements phrased imperative part algorithms algorithm") are be interpreted meaning key word used introducing algorithm. conformant resource requirements listed specification are applicable resources. conformant user agent requirements listed specification are applicable user agents. User agents resource authors employ algorithm implement specification, so long end result indistinguishable result be obtained specification's algorithms. Terminology terminology specification Web Origin Concept, HTML, HTTP URI. Terminology generally defined specification. However, few definitions did not really fit anywhere else are defined here instead. Comparing strings case-sensitive manner means comparing exactly, codepoint codepoint. Comparing strings ASCII case-insensitive manner means comparing exactly, codepoint codepoint, characters range U+0041 LATIN CAPITAL LETTER U+005A LATIN CAPITAL LETTER Z corresponding characters range U+0061 LATIN SMALL LETTER U+007A LATIN SMALL LETTER Z are considered also match. Converting string ASCII lowercase means replacing characters range U+0041 LATIN CAPITAL LETTER U+005A LATIN CAPITAL LETTER Z corresponding characters range U+0061 LATIN SMALL LETTER U+007A LATIN SMALL LETTER Z). term user credentials purposes specification means cookies, HTTP authentication, client-side SSL certificates be sent based user agent's previous interactions origin. Specifically not refer proxy authentication Origin header. term cross-origin used mean non same origin. method said be simple method case-sensitive match following: GET HEAD POST header said be simple header header field name ASCII case-insensitive match Accept, Accept-Language, Content-Language ASCII case-insensitive match Content-Type header field value media type parameters) ASCII case-insensitive match application/x-www-form-urlencoded, multipart/form-data, text/plain. header said be simple response header header field name ASCII case-insensitive match following: Cache-Control Content-Language Content-Type Expires Last-Modified Pragma parsing header header be parsed corresponding ABNF production syntax section. header not match production said header parsing failed. Security Considerations section non-normative. Security requirements considerations are listed specification. section lists advice did not fit anywhere else. simple cross-origin request been defined congruentwith be generated currently deployed user agents donot conform specification. Simple cross-origin requests generatedoutside specification cross-origin form submissions usingGET POST cross-origin GETrequests resulting script elements) typically includeuser credentials, so resources conforming specificationmust always be prepared expect simple cross-origin requests withcredentials. resources simple requests have significanceother retrieval protect Cross-Site Request Forgery(CSRF)by requiring inclusion unguessable token explicitlyprovided content request.[CSRF] specification authorize instance applicationfrom foreign origin, executing user agent, access therepresentation resource HTTP response. Certain types ofresources not attempt specify particular authorized origins, butinstead deny allow origins. resource not useful applications other origins, such login page, not return Access-Control-Allow-Origin header. resource still protect CSRF attacks, such requiring inclusion unguessable token explicitly provided content request. security properties such resources are unaffected user-agents conformant specification. resource publicly accessible, access control checks, always safely return Access-Control-Allow-Origin header value GET response entity body parse ECMAScript return Access-Control-Allow-Origin header value provided there are sensitive comments be accessed cross-origin using HTML script element. needed, such resources implement access control CSRF protections described Requests made user credentials, Origin headerrequire special consideration. requests have significance other retrieval, relying Origin header, resources be careful distinguish authorizing request side-effects) authorizing access representation resource response. Authorization request be performed using only intersection authority user requesting origin(s). often appropriate resources require authorization ceremony explicitly user consent cross-origin requests credentials be honored given origin. such cases, passing security tokens explicitly part cross-origin request remove ambiguity scope authorization. OAuth example pattern. Use user credentials cross-origin request appropriate cross-origin request credentials defined specification used substitute alternate methods authenticated resource sharing, such server-to-server back channels, JSONP, cross-document messaging. substitution expose additional attack surface cases, cross-site scripting vulnerability requesting origin allow elevation privileges requested resource compared server-to-server back channel. substitute JSONP-style cross-origin credentialed requests, use specification significantly security posture requesting application, cross-origin data access JSONP cross-origin code-injection. substitute cross-origin communication techniques relying loading resource, credentials, HTML iframe element, subsequently employing cross-document messaging other cross-origin side channels, specification roughly equivalent security posture. Again, data received origins are not completely trusted be validated conform expected formats authorized values. requests resources have significance other retrieval, credentials are used only provide user-specific customization otherwise publicly accessible information. case, restricting access certain origins protect user privacy preventing customizations being used identify user, authorized origins. specification used requests have significance other retrieval involve coordination data originating more origins, resources enabling editing, printing storage, distinct origins) requests set omit credentials flag resources perform authorization using security tokens explicitly provided content request, especially origins are not mutually completely trusted. such multi-origin scenarios, malicious resource origins be able enlist user-agent confused deputy elevate privileges abusing user credentials sent cross-origin requests. Avoiding such attacks coordinating applications have explicit knowledge scope privilege origin parameters instructions received are carefully validated step coordination ensure effects implied do not exceed authority originating principal. Given difficulty avoiding such vulnerabilities multi-origin interactions recommended instead using user credentials automatically attached request user agent, security tokens specify particular capabilities resources authorized be passed part explicit content request. OAuth again example such pattern. Authors client-side Web applications are strongly encouraged validate content retrieved cross-origin resource be harmful. Web applications are not uniquely identified specific host names, mapped specific ports, do not necessarily have unique origin, thus not be able securely utilize mechanism defined specification. origin composed only scheme, hostname, port. example, web application URL type example.org/app-name/ app-name portion necessary distinguish web application other web applications also running example.org, be unable securely employ mechanism defined specification. Mapping web applications distinct originsis vital secure web applications. Syntax section syntax new headers specification also short description function header. resource processing model section details resources are use headers response. Likewise, user agent processing model section details user agents are use headers. ABNF syntax used section HTTP/1.1. HTTP/1.1 used ABNF basis ensure new headers have equivalent parsing rules introduced specification. HTTP/1.1 currently not make leading OWS implied header value definitions form assumed here. Access-Control-Allow-Origin Response Header Access-Control-Allow-Origin header resource be shared based returning value Origin request header, response. ABNF: Access-Control-Allow-Origin = origin-list-or-null practice origin-list-or-null production more constrained. Rather allowing space-separated list origins, single origin string Access-Control-Allow-Credentials Response Header Access-Control-Allow-Credentials header response request be exposed omit credentials flag unset. part response preflight request actual request include user credentials. ABNF: Access-Control-Allow-Credentials: true true: %x74.72.75.65 case-sensitive Access-Control-Expose-Headers Response Header Access-Control-Expose-Headers header headers are safe expose API CORS API specification. ABNF: Access-Control-Expose-Headers = Access-Control-Max-Age Response Header Access-Control-Max-Age header long results preflight request be cached preflight result cache. ABNF: Access-Control-Max-Age = delta-seconds Access-Control-Allow-Methods Response Header Access-Control-Allow-Methods header part response preflight request, methods be used actual request. header isnot relevant purposes CORS protocol.ABNF: Access-Control-Allow-Methods: #Method Access-Control-Allow-Headers Response Header Access-Control-Allow-Headers header part response preflight request, header field names be used actual request. ABNF: Access-Control-Allow-Headers: Origin Request Header Origin header cross-origin request preflight request Access-Control-Request-Method Request Header Access-Control-Request-Method header method be used actual request part preflight request. ABNF: Access-Control-Request-Method: Method Access-Control-Request-Headers Request Header Access-Control-Request-Headers header headers be used actual request part preflight request. ABNF: Access-Control-Request-Headers: Resource Processing Model section processing models resources have implement. type request resource have deal described own subsection. resource sharing policy described specification bound particular resource. purposes section resource bound following: list origins consisting more origins are allowed access resource. include origin resource be aware requests cross-origin resources be redirected back resource. list methods consisting more methods are supported resource. list headers consisting more header field names are supported resource. list exposed headers consisting more header field names headers other simple response headers resource use be exposed. supports credentials flag resource supports user credentials request. true resource false otherwise. Simple Cross-Origin Request, Actual Request, Redirects response simple cross-origin request actual request resource not share response. resource been relocated, share new URL. Resources use following set steps determine additional headers use response: Origin header not present terminate set steps. request scope specification. value Origin header not case-sensitive match values list origins, do not set additional headers terminate set steps. Always matching acceptable list origins be unbounded. resource supports credentials add single Access-Control-Allow-Origin header, value Origin header value, add single Access-Control-Allow-Credentials header case-sensitive string value. Otherwise, add single Access-Control-Allow-Origin header, value Origin header string value. string be used resource supports credentials. list exposed headers not empty add more Access-Control-Expose-Headers headers, values header field names given list exposed headers. not adding appropriate headers resource also clear preflight result cache entries origin case-sensitive match value Origin header url case-sensitive match URL resource. Preflight Request response preflight request resource methods headers simple methods simple headers) willing handle supports credentials. Resources use following set steps determine additional headers use response: Origin header not present terminate set steps. request scope specification. value Origin header not case-sensitive match values list origins do not set additional headers terminate set steps. Always matching acceptable list origins be unbounded. Origin header only contain single origin user agent not follow redirects. Let method be value result parsing Access-Control-Request-Method header. there Access-Control-Request-Method header parsing failed, do not set additional headers terminate set steps. request scope specification. Let header field-names be values result parsing Access-Control-Request-Headers headers. there are Access-Control-Request-Headers headers let header field-names be empty list. parsing failed do not set additional headers terminate set steps. request scope specification. method not case-sensitive match values list methods do not set additional headers terminate set steps. Always matching acceptable list methods be unbounded. header field-names not ASCII case-insensitive match values list headers do not set additional headers terminate set steps. Always matching acceptable list headers be unbounded. resource supports credentials add single Access-Control-Allow-Origin header, value Origin header value, add single Access-Control-Allow-Credentials header case-sensitive string value. Otherwise, add single Access-Control-Allow-Origin header, value Origin header string value. string be used resource supports credentials. Optionally add single Access-Control-Max-Age header value amount seconds user agent allowed cache result request. method simple method step be skipped. Add more Access-Control-Allow-Methods headers consisting subset list methods. method simple method not need be listed, not prohibited. list methods be unbounded, simply returning method indicated Access-Control-Request-Method supported) be enough. header field-names simple header none Content-Type, step be skipped. Add more Access-Control-Allow-Headers headers consisting subset list headers. header field name simple header not Content-Type, not required be listed. Content-Type be listed only subset values makes qualify simple header. list headers be unbounded, simply returning supported headers Access-Control-Allow-Headers be enough. Security section non-normative. Resource authors are strongly encouraged ensure requests using safe methods, e.g. GET OPTIONS, have side effects so potential attackers modify user's data easily. resources are set up attackers effectively have be list origins do harm. addition checking Origin header, resource authors are strongly encouraged also check Host header. make sure host name provided header matches host name server resource provide protection DNS rebinding attacks. provide integrity protection resource sharing policy statements usage SSL/TLS encouraged. Implementation Considerations section non-normative. Resources wish enable be shared multiple Origins do not respond uniformly practice generate Access-Control-Allow-Origin header dynamically response request wish allow. consequence, authors such resources send Vary: Origin HTTP header provide other appropriate control directives prevent caching such responses, be inaccurate re-used across-origins. User Agent Processing Model section processing models user agents have implement. processing models sections need be referenced CORS API specification algorithm invoked return values are be handled. processing models are not suitable standalone use. Cross-Origin Request cross-origin request algorithm following parameters: request URL URL be fetched. request URL modified face redirects. request method method request. GET, explicitly set. author request headers list headers set authors request. Empty, explicitly set. request entity body entity body request. Missing, explicitly set. source origin origin request. Due specifics APIs be defined generic way therefore be provided argument. referrer source Document URL. Used determine Referer header. manual redirect flag Set redirects are not be automatically followed. omit credentials flag Set user credentials are be excluded request cookies are be ignored response. force preflight flag Set preflight request required. cross-origin request algorithm be used CORS API specifications wish allow cross-origin requests network APIs define. CORS API specifications are free limit abilities cross-origin request. E.g., omit credentials flag always be set. cross-origin request algorithm invoked, steps be followed: reason user agent not want make request terminate algorithm set cross-origin request status network error. request URL have been blacklisted user fashion. following conditions are true, follow simple cross-origin request algorithm: request method simple method force preflight flag unset. author request headers simple header author request headers empty. Otherwise, follow cross-origin request preflight algorithm. Cross-origin requests using method simple author request headers are not simple have preflight request ensure resource handle headers. requests using method not simple method.) Handling Response Cross-Origin Request User agents filter response headers other are simple response header field name ASCII case-insensitive match values Access-Control-Expose-Headers headers exposing response headers APIs defined CORS API specifications. getResponseHeader() method XMLHttpRequest therefore not expose header not indicated Cross-Origin Request Status cross-origin request associated cross-origin request status CORS API specifications enable API make cross-origin requests hook take most distinct values course cross-origin request. values are: preflight complete user agent make actual request. success resource be shared. abort error user aborted request. network error resource be shared. Also used DNS error, TLS negotiation failure, other type network error not include HTTP responses indicate type error, such HTTP status code Source Origin source origin initial origin user agents use Origin header. be modified redirect steps. Simple Cross-Origin Request steps describe user agents do simple cross-origin request: Apply make request steps observe request rules making request. manual redirect flag unset response HTTP status code Apply redirect steps. end user request Apply abort steps. there network error case DNS errors, TLS negotiation failure, other type network errors, apply network error steps. Do not request kind end user interaction. not include HTTP responses indicate type error, such HTTP status code Otherwise Perform resource sharing check. returns fail, apply network error steps. Otherwise, returns pass, terminate algorithm set cross-origin request status success. Do not actually terminate request. Cross-Origin Request Preflight protect resources cross-origin requests not originate certain user agents specification existed preflight request made ensure resource aware specification. result request stored preflight result cache. steps describe user agents do cross-origin request preflight. request non same-origin URL first needs be authorized using preflight result cache entry preflight request. Go step following conditions are true: request method there method cache match simple method force preflight flag unset. header author request headers there header cache match field name simple header. Otherwise, make preflight request. Fetch request URL origin source origin using referrer source override referrer source manual redirect flag block cookies flag set, using method OPTIONS, following additional constraints: Include Access-Control-Request-Method header header field value request method simple method). author request headers not empty include Access-Control-Request-Headers header header field value comma-separated list header field names author request headers lexicographical order, converted ASCII lowercase more are simple header). Exclude author request headers. Exclude user credentials. Exclude request entity body. following request rules are be observed making preflight request: end user request Apply abort steps. response HTTP status code not 2xx range Apply network error steps. cache network error steps are not used here actual network error. there network error case DNS errors, TLS negotiation failure, other type network errors, apply network error steps. Do not request kind end user interaction. not include HTTP responses indicate type error, such HTTP status code cache network error steps are not used here actual network error. Otherwise HTTP status code 2xx range) resource sharing check returns fail, apply cache network error steps. Let methods be empty list. there are more Access-Control-Allow-Methods headers let methods be values result parsing headers. parsing failed apply cache network error steps. methods still empty list force preflight flag set, request method methods. preflight requests happened solely force preflight flag are cached too. Let headers be empty list. there are more Access-Control-Allow-Headers headers let headers be values result parsing headers. parsing failed apply cache network error steps. request method not case-sensitive match method methods not simple method, apply cache network error steps. field name header author request headers not ASCII case-insensitive match header field names headers header not simple header, apply cache network error steps. reason user agent unable provide preflight result cache limited disk space) go step overall set steps actual request). there single Access-Control-Max-Age header, parse let max-age be resulting value. there such header, there more such header, parsing failed, let max-age be value discretion user agent allowed). user agent limit max-age field value max-age greater limit let max-age be limit. method methods there method cache match set max-age field value matching entry max-age. method methods there method cache match create new entry preflight result cache various fields set origin source origin. url request URL. max-age max-age. credentials False omit credentials flag set, true otherwise. method given method. header Empty. header headers there header cache match set max-age field value matching entry max-age. header headers there header cache match create new entry preflight result cache various fields set origin source origin. url request URL. max-age max-age. credentials False omit credentials flag set, true otherwise. method Empty. header given header. Set cross-origin request status preflight complete. actual request. Apply make request steps observe request rules making request. response HTTP status code Apply cache network error steps. end user request Apply abort steps. there network error case DNS errors, TLS negotiation failure, other type network errors, apply network error steps. Do not request kind end user interaction. not include HTTP responses indicate type error, such HTTP status code Otherwise Perform resource sharing check. returns fail, apply cache network error steps. Otherwise, returns pass, terminate algorithm set cross-origin request status success. Do not actually terminate request. Consider following scenario: user agent request API, such XMLHttpRequest, perform cross-origin request using custom XMODIFY method source origin http://example.org http://blog.example/entries/hello-world. user agent preflight request using OPTIONS method http://blog.example/entries/hello-world Origin Access-Control-Request-Method headers appropriate values. response request following headers: Access-Control-Allow-Origin: http://example.orgAccess-Control-Max-Age: 2520Access-Control-Allow-Methods: PUT, DELETE, XMODIFY user agent then desired request using XMODIFY method http://blog.example/entries/hello-world was allowed resource. addition, coming minutes, preflight request be needed. Preflight Result Cache mentioned, cross-origin request preflight uses preflight result cache. cache set entries. entry following fields: origin source origin. url request URL. max-age Access-Control-Max-Age header value. credentials False omit credentials flag set, true otherwise. method Empty header not empty; otherwise values Access-Control-Allow-Methods headers. header Empty method not empty; otherwise values Access-Control-Allow-Headers headers. be clear, method header fields are mutually exclusive. empty other non-empty. primary key entry fields excluding max-age field. Entries be removed time specified max-age field passed storing entry. Entries also be added removed algorithms are added removed such way there never be duplicate items cache. User agents clear cache entries time specified max-age field passed. effectively makes preflight result cache optional, user agents are strongly encouraged support Generic Cross-Origin Request Algorithms variables used generic set steps are part algorithms invoke set steps. Whenever make request steps are applied, fetch request URL origin source origin using referrer source override referrer source manual redirect flag set, block cookies flag set omit credentials flag set. Use method request method, entity body request entity body, including author request headers, include user credentials omit credentials flag unset. Whenever redirect steps are applied, follow set steps: Let original URL be request URL. Let request URL be URL conveyed Location header redirect response. request URL <scheme> not supported, infinite loop precautions are violated, user agent not wish make new request other reason, apply network error steps. request URL userinfo production apply network error steps. resource sharing check current resource returns fail, apply network error steps. request URL origin not same origin original URL origin, set source origin globally unique identifier transmitted). Transparently follow redirect observing set request rules. Whenever abort steps are applied, terminate algorithm invoked set steps set cross-origin request status abort error. Whenever network error steps are applied, terminate algorithm invoked set steps set cross-origin request status network error. effect setting user credentials. I.e. block cookies flag unset, cookies be set response. Whenever cache network error steps are applied, follow steps: Remove entries preflight result cache origin field value case-sensitive match source origin url field value case-sensitive match request URL. Apply network error steps acting algorithm invoked cache network error steps invoked network error steps instead. cache match there cache entry preflight result cache following true: origin field value case-sensitive match source origin. url field value case-sensitive match request URL. credentials field value true omit credentials flag unset, false omit credentials flag set. method cache match there cache entry there cache match method field value case-sensitive match given method. header cache match there cache entry there cache match header field value ASCII case-insensitive match given header field name. Resource Sharing Check resource sharing check algorithm given resource response more Access-Control-Allow-Origin header values, return fail terminate algorithm. Access-Control-Allow-Origin header value character omit credentials flag set, return pass terminate algorithm. value Access-Control-Allow-Origin not case-sensitive match value Origin header defined specification, return fail terminate algorithm. omit credentials flag unset response more Access-Control-Allow-Credentials header values, return fail terminate algorithm. omit credentials flag unset Access-Control-Allow-Credentials header value not case-sensitive match return fail terminate algorithm. Return pass. algorithm also functions ASCII serialization origin string Security section non-normative. various places user agents are allowed take additional precautions. E.g. user agents are allowed not store cache items, remove cache items reached max-age, not connect certain URLs. User agents are encouraged impose limit max-age so items stay preflight result cache unreasonable amounts time. indicated first step cross-origin request algorithm redirect steps algorithm user agents are allowed terminate algorithm not make request. be done e.g.: origin resource blacklisted. origin resource known be part intranet. URL <scheme> not supported. https http not allowed. https not allowed certificate errors User agents are encouraged apply security decisions generic level not just resource sharing policy. E.g. user agent requests https http scheme cross-origin request encouraged do same HTML img element. CORS API Specification Advice section non-normative. specification resource sharing policy be implemented API specification API uses policy CORS API specification. case CORS API specification multiple APIs utilize policy advice be considered separately API. Constructing Cross-Origin Request cross-origin requests APIs make resource sharing policy specification supposed apply, CORS API specification needs reference cross-origin request algorithm set following input variables appropriately: request URL, request method, author request headers, request entity body, source origin, manual redirect flag, omit credentials flag, force preflight flag. CORS API specifications are allowed let input variables be controlled API, also set fixed values. CORS API specification API only requests using GET method set request method GET, request entity body empty, source origin appropriate value let other variables be controlled API. Dealing Same Origin Cross-Origin Redirects browsers are based same origin security model policy outlined specification intended APIs used browsers, expected APIs utilize policy have handle same origin request results redirect cross-origin special way. APIs transparently handle redirects CORS API specifications are encouraged handle scenario transparently well redirect invoking cross-origin request algorithm redirect URL. XMLHttpRequest specification Dealing Cross-Origin Request Status cross-origin request progressing associated cross-origin request status updated. Depending value cross-origin request status API react different way: preflight complete Features only be safely exposed preflight request now be enabled. E.g. upload progress events XMLHttpRequest. success contents response be shared API, including headers have not been filtered out. request still be progressing. I.e. cross-origin request status value not indicate request completed. abort error Handle analogous requests user aborted request. be handled equivalently network error handled. Ensure not reveal further information request. network error Handle analogous requests kind error occurred. Ensure not reveal further information request. Security Similarly same origin requests, CORS API specifications are encouraged properly limit headers, methods, user credentials author set get requests are cross-origin. Reviewing XMLHttpRequest specification good start kind limitations are be imposed. CORS API specifications also need ensure not reveal anything cross-origin request status set preflight complete success prevent e.g. port scanning. XMLHttpRequest progress events are dispatched only cross-origin request status set success. Upload progress events are only dispatched once cross-origin request status preflight complete. References Confused Deputy, Norm Hardy. HTTP State Management Mechanism, Adam Barth. IETF. Cross-Site Request Forgeries, Peter Watkins. Server-Sent Events, Ian Hickson. W3C. HTML5, Berjon, Leithead, Navara, O'Connor, Pfeiffer Hickson. W3C. Hypertext Transfer Protocol HTTP/1.1, Roy Fielding, James Gettys, Jeffrey Mogul et al.. IETF. Hypertext Transfer Protocol Status Code Redirect), Julian Reschke. IETF. JSONP, Bob Ippolito. OAuth Protocol, Eran Hammer-Lahav. IETF. Web Origin Concept, Adam Barth. IETF. Key words use RFCs Indicate Requirement Levels, Scott Bradner. IETF. Uniform Resource Identifier Generic Syntax, Tim Berners-Lee, Roy Fielding Larry Masinter. IETF. XMLHttpRequest, Anne van Kesteren. W3C. Acknowledgments appendix non-normative. editor thank Adam Barth, Alexey Proskuryakov, Arne Johannessen, Arthur Barstow, Benjamin Hawkes-Lewis, Bert Bos, Björn Höhrmann, Boris Zbarsky, Brad Hill, Cameron McCormack, Collin Jackson, David Håsäther, David Orchard, Dean Jackson, Eric Lawrence, Frank Ellerman, Frederick Hirsch, Graham Klyne, Hal Lockhart, Henri Sivonen, Ian Hickson, Jesse M. Heines, Jonas Sicking, Julian Reschke, Lachlan Hunt, Lu), Maciej Stachowiak, Marc Silbey, Marcos Caceres, Mark Nottingham, Mark S. Miller, Martin Dürst, Matt Womer, Mhano Harkness, Michael Smith, Mohamed Zergaoui, Nikunj Mehta, Odin Hørthe Omdal, Philip Jägenstedt, Sharath Udupa, Simon Pieters, Sunava Dutta, Surya Ismail, Thomas Roessler, Tyler Close, Jeff Hodges, Vladimir Dzhuvinov, Wayne Carr, Zhenbin Xu contributions specification. Special thanks Brad Porter, Matt Oshry R. Auburn, helped editing earlier versions document. 