HTML Imports HTML Imports W3C Working Draft March version http://www.w3.org/TR/2014/WD-html-imports-20140311/ Latest version http://www.w3.org/TR/html-imports/ Previous version http://www.w3.org/TR/2013/WD-html-imports-20130514/ Revision history https://github.com/w3c/webcomponents/commits/gh-pages/spec/imports/ Participate Discuss public-webapps@w3.org Applications Working Group) File bugs Bugzilla) Editor Dimitri Glazkov, Google, <dglazkov@chromium.org> Hajime Morrita, Google, <morrita@chromium.org> Copyright Â© W3CÂ® ERCIM, Keio, Beihang), Rights Reserved. W3C liability, trademark document use rules apply. Abstract HTML Imports are way include reuse HTML documents other HTML documents. Status Document section status document time publication. Other documents supersede document. list current W3C publications latest revision technical report be found W3C technical reports index http://www.w3.org/TR/. document was published Web Applications Working Group Working Draft. wish make comments regarding document, please send public-webapps@w3.org archives) Subject: prefix feedback welcome. Publication Working Draft not imply endorsement W3C Membership. draft document be updated, replaced obsoleted other documents time. inappropriate cite document other work progress. document was produced group operating February W3C Patent Policy. W3C public list patent disclosures made connection deliverables group; page also instructions disclosing patent. individual actual knowledge patent individual Essential Claim(s) disclose information accordance section W3C Patent Policy. Table Contents Document Dependencies Terminology Link Type Extensions HTMLLinkElement interface Loading Imports Import Dependent Requesting Import Fetching Import Imports Content Security Policy Parsing Imports Additions Prepare Script Algorithm Additions Tree Construction Algorithm Additions Parsing XHTML Documents Additions document.write() method Scripting Imports Additions Script Enabling Criteria Additions document.currentScript Style processing Imports Events Imports Additions Event Handlers Acknowledgements Document diagrams, examples, notes, are non-normative, well sections explicitly marked non-normative. Everything else specification normative. key words NOT", NOT", NOT", normative parts document are be interpreted described RFC2119. readability, words do not appear uppercase letters specification. point, conforming UA make decisions state reaction state conceptual model, captured algorithm. algorithms are defined terms processing equivalence. processing equivalence constraint imposed algorithm implementors, requiring output UA-implemented specified algorithm be exactly same inputs. Dependencies document following specifications: DOM4 Core) HTML DOM Parsing Serialization ECMAScript Language Specification URL Terminology HTML Imports, just imports here are HTML documents are linked external resources HTML document. document links import called import referrer. given import, import referrer ancestor import referrer import referrer ancestor import referrer. import referrer own browsing context called master document. import associated master document: referrer import master document, master document import. Otherwise, master document import referrer master document import. Imported documents share defaultView master document.(See Bug Bug URL import called import location. import referrer, import represented Document, called imported document. imported documents don't have browsing context. set imports associated master document forms import map master document. maps stores imports items import locations keys. import map empty beginning. New items are added map import fetching algorithm Link Type enable declaring imports HTML, new link type added HTML link types: import keyword be used link elements. keyword external resource link import. default type resources given import keyword text/html. link element have async attribute. async attribute boolean attribute. appropriate time obtain resource external resource link created element inserted document, last. following document import, located <!DOCTYPE html><html lang="en-US"> <head> <title>Human Being</title> <link rel="import" href="/imports/heart.html"> </head> <body> <p>What body heart?</p> </body></html> Extensions HTMLLinkElement Interface partial interface LinkImport readonly attribute Document? import;};HTMLLinkElement LinkImport; getting, import attribute return null, link not represent import user agent not support imports link element not Document Otherwise, attribute return imported document import, represented link element. same object be returned time. Here's access imported document, mentioned previous example: var link = document.querySelector('link[rel=import]');var heart = link.import;// Access DOM document pulse = heart.querySelector('div.pulse'); import context Document HTML parser XML Parser said be import blocking scripts element was created Document's parser, element link type import element was created parser, link not marked async, import yet be completely loaded, last time event loop reached step element was Document, user agent given up import yet. user agent give up import time. Giving up import loads, even import eventually still load, means script end up operating incorrect information. example, import custom element script availability element, script find element unavailable user agent up early. Implementors have balance likelihood script using incorrect information performance impact doing nothing waiting slow network request finish. Document import blocking scripts there import blocking scripts Document's import dependent.A Document import blocking scripts not have import blocking scripts defined previous paragraph. sate import blocking scripts" change time existing import completely loaded new import loading started. HTML parser changes unblock such timings. Loading Imports Import Dependent document import link list, item consist link, link element location, URL.Also, item optionally marked cycle.The list empty beginning item added import request altorighm imported document more import ancestors. import ancestor document. import link list document non-cycle item location points document B, import ancestor B. B also called import parent Document. import ancestor transitive: document C import ancestor document B document B import ancestor document C import ancestor document A. imported document also more import predecessor. import predecessor document. URL document located URL document B import link list B's import parent, import predecessor B. import predecessor transitive. document import predecessor document B B redecessor document C, import predecessor C. Document import ancestors import predecessors document linked non-cycle item import link list, import dependent A. import link list import dependent order script execution imports. intend give deterministic order script execution defined order link element import. linking structure import link lists forms directed asyclic graph node DAG document edge link. be tree more link point same import. cycle marked import request algorithm excluded dependency calculation.The edges node ordered terms import link list. import predecessors selection aware order. example import link lists. figure, document import link list link B link C. document D set import ancestors are B c. B import ancestor D, D's list item points B marked cycle. import predecessors E are B D, import ancestors are C import link list empty. Thus import dependents are B, C D. document D import parents are B C. difference import referrer import parent import referrer state node tree import parent built algorithm described document. Requesting Import user agents attempt obtain linked import, also run import request algorithm, equivalent running steps: Input LINK, link element external resource link import. LOCATION, URL linked resource. async attribute LINK true, mark LINK async. Let DOCUMENT be document LINK. Let LIST be import link list DOCUMENT. Let ITEM be LINK LOCATION: there import ancestor DOCUMENT URL same LOCATION, Mark ITEM cycle. Add ITEM end LIST. Fetching Import imports linked documents master document import map be loaded using potentially CORS-enabled fetch mode set import fetched, user agent run import fetching algorithm, be equivalent running steps: Input LINK, link element makes external resource link import. LOCATION, import location Output IMPORT, imported document. LOCATION already import map: Let IMPORT be imported document LOCATION stop. Fetch resource LOCATION, IMPORT overnride referrer source block cookies flag set: fetched response type error: Add LOCATION null import map stop. Let IMPORT be new Document, document's address LOCATION Set IMPORT quirks mode. Let PARSER be new HTML parser, associated IMPORT Input DOCTYPE token PARSER's tree construction stage name force-quirks flag turned off. See Bug Add LOCATION IMPORT import map. task networking task source places task queue fetching: Fill PARSER's input byte stream fetched bytes Let PARSER process input byte stream utf-8 known definite encoding more bytes are available: Queue task networking task source PARSER process implied EOF character loaded imports imports loading are import link list, thus import linked imports list also be loaded using import fetching algorithm, LOCATION be import location import. loading attempt be considered successful IMPORT not null algorithm completion, failed otherwise. link element fires simple event called loadfor successful loading attempt. failed attempt, fires simple event named error. Imports Content Security Policy Content Security Policy restrict import loading script-src directive. import be restricted Content Security Policy master document.For example, Content Security Header Field sent import, user agent enforce policy master document imported document. Parsing Imports Parsing behaviour imports defined set changes HTML Parsing. Additions Prepare Script Algorithm step prepare script algorithm, modify last part condition element not have src attribute read: Document HTML parser XML parser created script element style sheet blocking scripts import blocking scripts Additions Tree Construction Algorithm sub-condition named Otherwise condition end tag name insertion mode, modify step read: parser's Document style sheet blocking scripts import blocking scripts script's be parser-executed" flag not set: spin event loop parser's Document style sheet blocking scripts import blocking scripts script's be parser-executed" flag set. Modify sub-step step end read: Spin event loop first script list scripts execute Document finished parsing be parser-executed" flag set parser's Document style sheet blocking scripts import blocking scripts. import dependents be loaded DOMContentLoaded fired. See Bug Additions Parsing XHTML Documents Modify step steps run following preparing script element read: Spin event loop parser's Document style sheet blocking scripts import blocking scripts pending parsing-blocking script's be parser-executed" flag set. Additions document.write() method Insert following step step step document.write() method: document.currentScript points element owned active document, then abort steps. See Bug Scripting Imports Additions Script Enabling Criteria Add following condition list Enabling disabling scripting criteria: Scripting enabled node Document object node import map. Additions document.currentScript Modify definition document.currentScriptas currentScript attribute, getting,must return value was most recently initialized document import map document.When Document created, currentScript be initialized null.If Document imported document, currentScript always null. Style processing Imports contents style elements andthe external resources link elements imports be considered input sources style processing model master document. declarations different documents, document order terms order appearance defined based document order link elements import referrer ancestors are same document. are more such documents, comparison result first document, document order, wins. See Bug Events Imports Events imports defined set changes HTML Events. Additions Event Handlers Modify event handler content attribute'sscript creation criteria expanding first paragraph: event handler content attribute set, element owned Document browsing context import map, Acknowledgements David Hyatt developed XBL Ian Hickson co-wrote XBL documents provided tremendous insight problem behavior attachment greatly influenced specification. Alex Russell considerable forethought triggered new wave enthusiasm subject behavior attachment be applied practically Web. Dominic Cooney Roland Steiner worked tirelessly scope problem confines Web platform provided solid foundation document. editor also thank Alex Komoroske, Angelina Fabbro, Anne van Kesteren, Boris Zbarsky, Brian Kardell, Daniel Buchner, Edward O'Connor, Eric Bidelman, Erik Arvidsson, Elliott Sprehn, Gabor Krizsanits, Hayato Ito, James Simonsen, Jonas Sicking, Ken Shirriff, Neel Goyal, Olli Pettay, Rafael Weinstein, Scott Miles, Steve Orvell, Tab Atkins, William Chan, William Chen comments contributions specification. list too short. lot work left do. contribute reviewing filing bugs—and don't forget ask editor add name section. 